# PDF-Auto-BookMark

结合AI视觉识别自动为PDF添加书签

## 项目简介

PDF-Auto-BookMark 是一个自动为PDF文件添加书签的工具。通过结合AI视觉识别能力，可以快速准确地为没有书签的PDF文档生成完整的书签目录，极大提升阅读体验。

> **注意**: 本项目目前处于规划阶段，Python脚本和依赖文件将在后续版本中提供。本README描述了完整的工作流程和使用方法。

## 功能特点

- 🤖 利用AI视觉识别技术自动识别PDF目录结构
- 📑 支持多级目录层次结构（通过缩进识别）
- 📄 智能处理逻辑页码与物理页码的对应关系
- ✨ 自动化程度高，减少手动操作
- 🎯 准确快速，提升PDF阅读体验

## 环境要求

### Python版本
- Python 3.6 或更高版本

### 依赖库
- `PyPDF2` 或 `pypdf` - PDF文件处理
- `pikepdf` - PDF书签编辑（推荐）

可以通过以下命令安装依赖：

```bash
pip install PyPDF2
# 或者
pip install pypdf
# 推荐使用 pikepdf
pip install pikepdf
```

### AI工具要求
- 任何具备基本图像识别能力的AI工具（如ChatGPT、Claude、文心一言等）
- 能够识别图片中的文字并按要求格式化输出

## 安装步骤

1. 克隆本仓库：
```bash
git clone https://github.com/Gongzihang6/PDF-Auto-BookMark.git
cd PDF-Auto-BookMark
```

2. 安装依赖：
```bash
# 手动安装依赖（requirements.txt 将在后续版本提供）
pip install pikepdf PyPDF2
```

## 使用方法

### 第一步：截取PDF目录

打开你的PDF文件，找到目录页，将目录内容截图保存。

示例目录截图应包含：
- 章节标题
- 小节标题
- 对应的页码

### 第二步：使用AI工具识别并格式化目录

1. 将截图上传到任何具备图像识别能力的AI工具（ChatGPT、Claude、Gemini等）

2. 向AI发送提示词，例如：
```
请将这张图片中的目录内容整理成文本格式，要求：
- 保持原有的层级结构
- 使用4个空格表示缩进层级
- 格式：标题 + 空格 + 页码
- 不要添加其他符号或格式
```

3. 将AI返回的格式化目录保存为 `.txt` 文件

### 第三步：准备目录文本文件

目录文本文件格式要求（**重要**）：
- 使用 **4个空格** 表示每一级缩进
- 每行格式：`标题 页码`
- 页码在最后，前面用空格分隔

**示例格式：**

```
第1章 引言 1
    1.1 状态估计简史 1
    1.2 传感器、测量和问题定义 3
    1.3 本书组织结构 4
    1.4 与其他教程的关系 5
第2章 概率论基础 7
    2.1 随机变量和概率分布 7
        2.1.1 离散随机变量 8
        2.1.2 连续随机变量 10
    2.2 期望和方差 15
    2.3 多元高斯分布 20
第3章 状态估计基础 25
    3.1 贝叶斯滤波 25
    3.2 卡尔曼滤波 30
```

**格式说明：**
- 顶级章节：无缩进
- 二级标题：4个空格缩进
- 三级标题：8个空格缩进（两个4空格）
- 以此类推

### 第四步：运行Python脚本添加书签

> **注意**: `add_bookmark.py` 脚本将在后续版本中提供，以下为预期的使用方式。

```bash
python add_bookmark.py <PDF文件路径> <目录文本文件路径> [输出PDF文件路径]
```

**参数说明：**
- `<PDF文件路径>`：需要添加书签的原始PDF文件
- `<目录文本文件路径>`：第三步准备的目录文本文件
- `[输出PDF文件路径]`（可选）：输出的PDF文件路径，默认为 `output.pdf`

**使用示例：**

```bash
# 基本用法
python add_bookmark.py book.pdf toc.txt

# 指定输出文件
python add_bookmark.py book.pdf toc.txt book_with_bookmarks.pdf
```

### 第五步：配置逻辑页码与物理页码映射

有些PDF文档的逻辑页码（书中显示的页码）与物理页码（PDF文件中的实际页数）不一致。例如：
- 封面、版权页可能占用前几页，但书中正文从第1页开始
- 前言部分可能使用罗马数字页码

脚本支持配置页码偏移量，在运行时通过参数或配置文件指定：

```bash
# 使用页码偏移参数（物理页码 = 逻辑页码 + 偏移量）
python add_bookmark.py book.pdf toc.txt --offset 10
```

或在脚本中直接配置偏移量。

## 完整工作流程示例

假设你有一本名为 `state_estimation.pdf` 的书：

1. **截取目录**：打开PDF，截取目录页，保存为 `toc_screenshot.png`

2. **AI识别**：
   - 上传 `toc_screenshot.png` 到ChatGPT
   - 输入提示：「请提取图片中的目录，用4个空格缩进表示层级，格式为：标题 页码」
   - 复制AI输出的文本

3. **保存目录**：将AI返回的文本保存为 `toc.txt`
   ```
   第1章 引言 1
       1.1 状态估计简史 1
       1.2 传感器、测量和问题定义 3
   ...
   ```

4. **运行脚本**：
   ```bash
   python add_bookmark.py state_estimation.pdf toc.txt state_estimation_bookmarked.pdf
   ```

5. **检查结果**：打开 `state_estimation_bookmarked.pdf`，查看书签是否正确添加

## 注意事项

1. **目录格式**：
   - 必须使用 **4个空格** 缩进，不要使用Tab
   - 页码必须在最后，使用空格分隔
   - 确保层级关系正确

2. **页码对应**：
   - 如果书中页码与PDF页码不一致，需要配置偏移量
   - 可以先用几个书签测试，确认偏移量是否正确

3. **AI识别**：
   - 目录较长时，可以分多次截图识别
   - 识别后需要人工检查格式是否正确
   - 注意AI可能会添加额外的符号，需要清理

4. **编码问题**：
   - 目录文本文件建议使用 UTF-8 编码
   - Windows系统注意文件编码格式

5. **PDF兼容性**：
   - 某些加密或受保护的PDF可能无法添加书签
   - 建议先用简单的PDF测试

## 常见问题

### Q1: 书签位置不准确怎么办？
**A**: 检查逻辑页码与物理页码的偏移量设置，调整 `--offset` 参数。

### Q2: AI识别的格式不对怎么办？
**A**: 手动调整文本文件，确保使用4个空格缩进，页码在最后。

### Q3: 支持哪些AI工具？
**A**: 任何能识别图片文字的AI工具都可以，如ChatGPT、Claude、Gemini、文心一言、通义千问等。

### Q4: 可以批量处理多个PDF吗？
**A**: 可以编写脚本循环调用，每个PDF需要对应的目录文本文件。

## 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 许可证

本项目采用 MIT 许可证。

## 联系方式

如有问题或建议，欢迎通过GitHub Issues联系。
